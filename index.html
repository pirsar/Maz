<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>مازندران</title>
  <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@500;700&display=swap" rel="stylesheet" />
  <style>
    body {
      margin: 0;
      font-family: 'Vazirmatn', sans-serif;
      background: #fdfdfd;
      text-align: center;
      color: #333;
      overflow-x: hidden;
      position: relative;
      min-height: 100vh;
    }
    header {
      background-color: #e6f2ef;
      padding: 2rem 1rem;
      position: relative;
      z-index: 10;
    }
    .logo {
      font-size: 3rem;
      font-weight: 700;
      color: #2a7a66;
      display: inline-block;
      position: relative;
    }
    .lang-buttons {
      margin-top: 1rem;
    }
    .lang-buttons a {
      display: inline;
      margin: 0 0.5rem;
      font-size: 1.5rem;
      padding: 0.5rem 1rem;
      background: #2a7a66;
      color: #fff;
      border-radius: 8px;
      text-decoration: none;
      transition: background 0.3s;
    }
    .lang-buttons a:hover {
      background: #206456;
    }
    .main-image {
      width: 100%;
      max-height: 500px;
      object-fit: cover;
      position: relative;
      z-index: 5;
    }
    .poem {
      font-size: 1.6rem;
      font-weight: 500;
      margin: 2rem 1rem 4rem 1rem;
      color: #444;
      position: relative;
      z-index: 10;
    }
    /* پروانه‌ها */
    .butterfly {
      width: 50px;
      height: 50px;
      position: absolute;
      pointer-events: none;
      user-select: none;
      filter: drop-shadow(0 0 2px rgba(0,0,0,0.2));
      will-change: transform, top, left;
      transition: transform 0.3s ease;
    }
    /* رنگ‌های مختلف به کمک فیلتر hue-rotate */
    .butterfly:nth-child(1) {
      filter: drop-shadow(0 0 3px #ff4081);
    }
    .butterfly:nth-child(2) {
      filter: drop-shadow(0 0 3px #3f51b5);
    }
    .butterfly:nth-child(3) {
      filter: drop-shadow(0 0 3px #ff9800);
    }
    @media (max-width: 600px) {
      .logo {
        font-size: 2.2rem;
      }
      .lang-buttons a {
        font-size: 1.2rem;
        padding: 0.4rem 0.8rem;
      }
      .poem {
        font-size: 1.3rem;
      }
      .butterfly {
        width: 35px;
        height: 35px;
      }
    }
  </style>
</head>
<body>

  <header>
    <div class="logo" id="logo">مازندران</div>
    <div class="lang-buttons">
      <a href="index.fr.html">🇫🇷 </a>
      <a href="index.fa.html">☘️ </a>
      <a href="index.en.html">🇬🇧 </a>
    </div>
  </header>

  <img src="https://i.imgur.com/Ch2abmO.jpeg" alt="تصویری از مازندران" class="main-image" id="mainImage">

  <div class="poem" id="poem">
    که مازندران شهر ما یاد باد<br />
    همیشه بر و بومش آباد باد
  </div>

  <!-- پروانه‌ها -->
  <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/4/44/Butterfly_icon.svg/1024px-Butterfly_icon.svg.png"
       alt="پروانه" class="butterfly" id="butterfly1" />
  <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/4/44/Butterfly_icon.svg/1024px-Butterfly_icon.svg.png"
       alt="پروانه" class="butterfly" id="butterfly2" />
  <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/4/44/Butterfly_icon.svg/1024px-Butterfly_icon.svg.png"
       alt="پروانه" class="butterfly" id="butterfly3" />

  <script>
    const logo = document.getElementById('logo');
    const mainImage = document.getElementById('mainImage');
    const poem = document.getElementById('poem');
    const butterflies = [
      document.getElementById('butterfly1'),
      document.getElementById('butterfly2'),
      document.getElementById('butterfly3'),
    ];

    function updatePositions() {
      const logoRect = logo.getBoundingClientRect();
      const mainImageRect = mainImage.getBoundingClientRect();
      const poemRect = poem.getBoundingClientRect();

      return {
        startX: logoRect.left + logoRect.width / 2 + window.scrollX,
        startY: logoRect.top + logoRect.height / 2 + window.scrollY,
        imageX: mainImageRect.left + mainImageRect.width / 2 + window.scrollX,
        imageY: mainImageRect.top + mainImageRect.height / 2 + window.scrollY,
        poemX: poemRect.left + poemRect.width / 2 + window.scrollX,
        poemY: poemRect.top + poemRect.height / 2 + window.scrollY,
      };
    }

    function animateButterfly(butterfly, delay, phaseOffset) {
      let start = null;
      const duration = 15000; // ۱۵ ثانیه کل چرخه
      const radius = 80; // شعاع چرخش روی عکس

      function step(timestamp) {
        if (!start) start = timestamp;
        const elapsed = (timestamp - start + delay) % duration;
        const progress = elapsed / duration;

        const pos = updatePositions();

        if (progress < 0.2) {
          // حرکت خطی از لوگو به مرکز عکس
          const t = progress / 0.2;
          const x = pos.startX + t * (pos.imageX - pos.startX);
          const y = pos.startY + t * (pos.imageY - pos.startY);
          butterfly.style.left = (x - butterfly.width / 2) + 'px';
          butterfly.style.top = (y - butterfly.height / 2) + 'px';
          butterfly.style.transform = `rotate(${t * 360}deg)`;
        } else if (progress < 0.6) {
          // چرخش روی عکس
          const t = (progress - 0.2) / 0.4;
          const angle = 2 * Math.PI * t + phaseOffset;
          const x = pos.imageX + radius * Math.cos(angle);
          const y = pos.imageY + radius * Math.sin(angle) * 0.6; // بیضی کمی
          butterfly.style.left = (x - butterfly.width / 2) + 'px';
          butterfly.style.top = (y - butterfly.height / 2) + 'px';
          butterfly.style.transform = `rotate(${angle * 180 / Math.PI + 45}deg)`;
        } else if (progress < 0.8) {
          // حرکت خطی از عکس به شعر
          const t = (progress - 0.6) / 0.2;
          const x = pos.imageX + t * (pos.poemX - pos.imageX);
          const y = pos.imageY + t * (pos.poemY - pos.imageY);
          butterfly.style.left = (x - butterfly.width / 2) + 'px';
          butterfly.style.top = (y - butterfly.height / 2) + 'px';
          butterfly.style.transform = `rotate(${t * 360}deg)`;
        } else {
          // پرواز آزاد روی صفحه، حرکتی نوسانی
          const t = (progress - 0.8) / 0.2;
          const x = pos.poemX + 150 * Math.cos(2 * Math.PI * t + phaseOffset);
          const y = pos.poemY + 100 * Math.sin(2 * Math.PI * t + phaseOffset * 1.5);
          butterfly.style.left = (x - butterfly.width / 2) + 'px';
          butterfly.style.top = (y - butterfly.height / 2) + 'px';
          butterfly.style.transform = `rotate(${t * 360 * 2}deg)`;
        }

        requestAnimationFrame(step);
      }

      requestAnimationFrame(step);
    }

    // شروع انیمیشن برای هر پروانه با تأخیر و فاز متفاوت
    animateButterfly(butterflies[0], 0, 0);
    animateButterfly(butterflies[1], 5000, Math.PI * 2 / 3);
    animateButterfly(butterflies[2], 10000, Math.PI * 4 / 3);

    // به‌روزرسانی موقعیت‌ها هنگام تغییر اندازه پنجره (رفرش صفحه)
    window.addEventListener('resize', () => {
      // اینجا هیچ کاری نمی‌کنیم چون موقعیت‌ها هر بار در انیمیشن گرفته می‌شود
      // اما اگر لازم شد می‌توانیم اینجا کاری کنیم
    });
  </script>
</body>
</html>
