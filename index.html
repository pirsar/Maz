<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>مازندران - پروانه‌ها</title>
<style>
  body {
    margin: 0;
    font-family: 'Vazirmatn', sans-serif;
    background: #fdfdfd;
    text-align: center;
    color: #333;
    overflow-x: hidden;
    position: relative;
    min-height: 100vh;
  }
  header {
    background-color: #e6f2ef;
    padding: 2rem 1rem;
    position: relative;
    z-index: 10;
  }
  .logo {
    font-size: 3rem;
    font-weight: 700;
    color: #2a7a66;
    display: inline-block;
    position: relative;
  }
  .lang-buttons {
    margin-top: 1rem;
  }
  .lang-buttons a {
    display: inline;
    margin: 0 0.5rem;
    font-size: 1.5rem;
    padding: 0.5rem 1rem;
    background: #2a7a66;
    color: #fff;
    border-radius: 8px;
    text-decoration: none;
    transition: background 0.3s;
  }
  .lang-buttons a:hover {
    background: #206456;
  }
  .main-image {
    width: 100%;
    max-height: 500px;
    object-fit: cover;
    position: relative;
    z-index: 5;
  }
  .poem {
    font-size: 1.6rem;
    font-weight: 500;
    margin: 2rem 1rem 4rem 1rem;
    color: #444;
    position: relative;
    z-index: 10;
  }
  /* پروانه ساده با CSS */
  .butterfly {
    width: 40px;
    height: 40px;
    position: absolute;
    pointer-events: none;
    user-select: none;
    will-change: transform, top, left;
  }
  .butterfly .wing {
    position: absolute;
    width: 16px;
    height: 24px;
    background: linear-gradient(45deg, #ff6a6a, #ff0000);
    border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
    top: 8px;
    transform-origin: left center;
    animation: wingFlap 1.2s ease-in-out infinite;
    filter: drop-shadow(0 0 2px rgba(0,0,0,0.2));
  }
  .butterfly .wing.right {
    right: 0;
    background: linear-gradient(135deg, #6aafff, #0040ff);
    transform-origin: right center;
    animation-delay: 0.6s;
  }
  .butterfly .body {
    position: absolute;
    top: 10px;
    left: 50%;
    width: 8px;
    height: 20px;
    margin-left: -4px;
    background: #333;
    border-radius: 4px;
    box-shadow: inset 0 0 5px #666;
  }
  @keyframes wingFlap {
    0%, 100% { transform: rotate(20deg); }
    50% { transform: rotate(-20deg); }
  }
  @media (max-width: 600px) {
    .logo {
      font-size: 2.2rem;
    }
    .lang-buttons a {
      font-size: 1.2rem;
      padding: 0.4rem 0.8rem;
    }
    .poem {
      font-size: 1.3rem;
    }
    .butterfly {
      width: 30px;
      height: 30px;
    }
    .butterfly .wing {
      width: 12px;
      height: 18px;
      top: 6px;
    }
    .butterfly .body {
      width: 6px;
      height: 15px;
      top: 8px;
      margin-left: -3px;
    }
  }
</style>
</head>
<body>

  <header>
    <div class="logo" id="logo">مازندران</div>
    <div class="lang-buttons">
      <a href="index.fr.html">🇫🇷</a>
      <a href="index.fa.html">☘️</a>
      <a href="index.en.html">🇬🇧</a>
    </div>
  </header>

  <img src="https://i.imgur.com/Ch2abmO.jpeg" alt="تصویری از مازندران" class="main-image" id="mainImage" />

  <div class="poem" id="poem">
    که مازندران شهر ما یاد باد<br />
    همیشه بر و بومش آباد باد
  </div>

  <!-- پروانه‌ها -->
  <div class="butterfly" id="butterfly1">
    <div class="wing left"></div>
    <div class="wing right"></div>
    <div class="body"></div>
  </div>
  <div class="butterfly" id="butterfly2">
    <div class="wing left"></div>
    <div class="wing right"></div>
    <div class="body"></div>
  </div>
  <div class="butterfly" id="butterfly3">
    <div class="wing left"></div>
    <div class="wing right"></div>
    <div class="body"></div>
  </div>

<script>
  const logo = document.getElementById('logo');
  const mainImage = document.getElementById('mainImage');
  const poem = document.getElementById('poem');
  const butterflies = [
    document.getElementById('butterfly1'),
    document.getElementById('butterfly2'),
    document.getElementById('butterfly3'),
  ];

  function updatePositions() {
    const logoRect = logo.getBoundingClientRect();
    const mainImageRect = mainImage.getBoundingClientRect();
    const poemRect = poem.getBoundingClientRect();

    return {
      startX: logoRect.left + logoRect.width / 2 + window.scrollX,
      startY: logoRect.top + logoRect.height / 2 + window.scrollY,
      imageX: mainImageRect.left + mainImageRect.width / 2 + window.scrollX,
      imageY: mainImageRect.top + mainImageRect.height / 2 + window.scrollY,
      poemX: poemRect.left + poemRect.width / 2 + window.scrollX,
      poemY: poemRect.top + poemRect.height / 2 + window.scrollY,
    };
  }

  function animateButterfly(butterfly, delay, phaseOffset) {
    let start = null;
    const duration = 15000;
    const radius = 80;

    function step(timestamp) {
      if (!start) start = timestamp;
      const elapsed = (timestamp - start + delay) % duration;
      const progress = elapsed / duration;

      const pos = updatePositions();

      if (progress < 0.2) {
        // پرواز از لوگو به تصویر
        const t = progress / 0.2;
        const x = pos.startX + t * (pos.imageX - pos.startX);
        const y = pos.startY + t * (pos.imageY - pos.startY);
        butterfly.style.left = (x - butterfly.offsetWidth / 2) + 'px';
        butterfly.style.top = (y - butterfly.offsetHeight / 2) + 'px';
        butterfly.style.transform = `rotate(${t * 360}deg)`;
      } else if (progress < 0.6) {
        // چرخش دور تصویر
        const t = (progress - 0.2) / 0.4;
        const angle = 2 * Math.PI * t + phaseOffset;
        const x = pos.imageX + radius * Math.cos(angle);
        const y = pos.imageY + radius * Math.sin(angle) * 0.6;
        butterfly.style.left = (x - butterfly.offsetWidth / 2) + 'px';
        butterfly.style.top = (y - butterfly.offsetHeight / 2) + 'px';
        butterfly.style.transform = `rotate(${angle * 180 / Math.PI + 45}deg)`;
      } else if (progress < 0.8) {
        // پرواز از تصویر به شعر
        const t = (progress - 0.6) / 0.2;
        const x = pos.imageX + t * (pos.poemX - pos.imageX);
        const y = pos.imageY + t * (pos.poemY - pos.imageY);
        butterfly.style.left = (x - butterfly.offsetWidth / 2) + 'px';
        butterfly.style.top = (y - butterfly.offsetHeight / 2) + 'px';
        butterfly.style.transform = `rotate(${t * 360}deg)`;
      } else {
        // نشستن روی شعر و توقف کوتاه
        butterfly.style.left = (pos.poemX - butterfly.offsetWidth / 2) + 'px';
        butterfly.style.top = (pos.poemY - butterfly.offsetHeight / 2) + 'px';
        butterfly.style.transform = 'rotate(0deg)';
      }

      requestAnimationFrame(step);
    }

    requestAnimationFrame(step);
  }

  // شروع انیمیشن برای هر پروانه با تأخیر و فاز متفاوت
  butterflies.forEach((butterfly, i) => {
    animateButterfly(butterfly, i * 5000, (i * 2 * Math.PI) / butterflies.length);
  });

  // آپدیت موقعیت ها هنگام تغییر سایز صفحه
  window.addEventListener('resize', () => {
    // به طور خودکار موقعیت‌ها در هر فریم خوانده می‌شوند؛ نیاز به کار اضافی نیست
  });
</script>

</body>
</html>
